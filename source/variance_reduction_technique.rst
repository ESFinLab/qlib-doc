======================================
方差缩减技术及其应用
======================================

蒙特卡洛模拟需要大量的试验才能进行合理准确的估计。如果能够成倍地减少随机模拟中的误差方差，就可以有效地节省随机模拟时间。
本节将着重介绍方差缩减技术中的 **控制变量法**，及其在期权定价中的实际运用。

控制变量法
--------------------
控制变量法适用于与两个强相关的随机变量。设要估计的随机变量为 :math:`X`，其期望为 :math:`\text{E}(X) = \frac{1}{N} \sum_{i=1}^N X_i`，其中 :math:`N` 为样本个数。
为了提高精度，设另外一个随机变量 :math:`Y`，满足

.. math:: 
   \text{E}(Y) = 0

由此 :math:`\text{E}(X) = \text{E}(X + Y)`，于是

.. math:: 
    \text{Var}(X+Y) = \text{Var}(X) + \text{Var}(Y) + 2\text{Cov}(X,Y)

只要 :math:`\text{Var}(Y) + 2\text{Cov}(X,Y) < 0`，则 :math:`\text{Var}(X+Y) < \text{Var}(X)`。那么，用 :math:`\bar X + \bar Y` 估计的渐进方差就比用 :math:`\bar X` 来估计的渐进方差小。

为了更好地利用相关性，引入变量 :math:`b` ，使得

.. math:: 
    \text{E}(X) = \text{E}(X + bY),

则

.. math:: 
    \text{Var}(X + bY) = \text{Var}(X) + b^2 \text{Var}(Y) + 2b \text{Cov}(X,Y)

求出 :math:`\text{Var}(X + bY)` 中的最小值点，得

.. math::
    b = -\text{Cov}(X,Y) / \text{Var}(Y) 
      = -\rho_{X,Y}\sqrt{\text{Var}(X)/\text{Var}(Y)}

此时

.. math::
    \text{Var}(X + bY) = (1 - \rho_{X,Y}^2) \text{Var}(X) \leq \text{Var}(X)

于是，只要能够找到零均值随机变量 :math:`Y` 并且使得 :math:`\rho_{X,Y} \neq 0`，就可以减少 :math:`X` 的估计方差。


在期权中的实际应用
-----------------------
在期权定价中，需要两个 **相似的，相关性高** 的期权A和期权B:

#. 记期权A某次蒙特卡洛模拟下对应的路径 :math:`i` 下的现值为 :math:`A_i`；
#. 记期权B某次蒙特卡洛模拟下对应的路径 :math:`i` 下的现值为 :math:`B_i`；
#. 记期权B对应的真值为 :math:`B` ， 通常为期权的解析解。

现在构造 **控制变量法** 所需的随机变量 :math:`X` 和 :math:`Y`:

#. 设 :math:`X_i = A_i , Y_i = B - B_i`；
#. 根据之前的公式计算出对应的 :math:`b`；
#. 计算出对应的期权定价结果 :math:`\text{E}(X + bY)` 对随机变量 :math:`X` 进行估计， 替代了原来使用的 :math:`\text{E}(X)`。

示例
^^^^^^^^^^^
在实际金融市场中，离散型的障碍期权应用更为广泛。然而，解析解对于离散型障碍期权适用范围很小，仅适用于按日观察的情况。因此，
在以下的实证分析中，采用按月观察的向上敲出看涨期权为 **期权A**，按日观察的向上敲出看涨期权为 **期权B**, 对他们在相同路径下做100万次蒙特卡洛模拟。

向上敲出期权的基本条款设置如下：

.. list-table::

 * - **标的价格**
   - 100
 * - **行权价**
   - 80
 * - **到期时间**
   - 1年
 * - **期权A的观察频率**
   - 每20天按月观察
 * - **期权B的观察频率**
   - 按日观察
 * - **敲出障碍**
   - 105
 * - **敲出支付**
   - 香草看涨
 * - **未敲出支付**
   - 0

由于 **期权B** 没有对应的解析解，设 **期权A** 和 **期权B** 的真值为1千万次蒙特卡洛的结果，对应的真值结果为：

.. list-table::

 * - 
   - **期权A**
   - **期权B**
 * - **真值**
   - 1.1358
   - 0.5111



采用 **控制变量法** 后进行100万次蒙特卡洛模拟的对比结果如下：

.. list-table::
   
 * -
   - **原始结果**
   - **控制变量为B1**
 
 * - **期权A的现值**
   - 1.1392
   - 1.1367

 * - **误差**
   - 0.0039
   - 0.0030

 
其中， 误差衡量公式为 :math:`\sqrt{\text{Var}(X^*)/n}`， :math:`X^*` 为估计量，:math:`n` 为相应估计量的样本数量。 **期权A** 与 **期权B** 的相关系数为0.6190。 

通过使用 **控制变量法**，期权的计算误差会有效减小，相关系数越高计算误差越小，而且结果也会更加接近期权的真值。其限制条件也较为明显，在大多数情况下，
对于离散型障碍期权而言，很难找到一个相关度很高的，并有解析解的相似期权。
虽然对应的相似期权B可以通过使用1千万蒙特卡洛模拟计算并作为其真值，但是就总体计算速度而言，并没有达到预期的效率提升效果。
